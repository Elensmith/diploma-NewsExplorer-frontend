!function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=10)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{static errorCatch(e){return Promise.reject(e)}static errorThen(e){return e.ok?e.json():Promise.reject(e)}static errorThenStatus(e){return e.ok?e.json():Promise.reject(e.status)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{constructor(){this._listeners=[]}_addListener(e,t,s){this.element=e,e.addEventListener(t,s)}_setListeners(e){e.forEach(e=>{this._addListener(...e)})}_removeListeners(){this._listeners.forEach(e=>{const{element:t,event:s,callback:r}=e;t.removeEventListener(s,r)})}}},function(e,t,s){"use strict";s.d(t,"c",(function(){return r})),s.d(t,"b",(function(){return i})),s.d(t,"d",(function(){return n})),s.d(t,"a",(function(){return a}));const r=()=>new Date(Date.now()-6048e5),i=e=>`${new Intl.DateTimeFormat("ru",{year:"numeric"}).format(e)}-${new Intl.DateTimeFormat("ru",{month:"numeric"}).format(e)}-${new Intl.DateTimeFormat("ru",{day:"numeric"}).format(e)}`,n=()=>new Date,a=e=>`${new Intl.DateTimeFormat("ru",{day:"numeric"}).format(e)} ${new Intl.DateTimeFormat("ru",{month:"long"}).format(e)}, ${new Intl.DateTimeFormat("ru",{year:"numeric"}).format(e)}`},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var r=s(1),i=s(2);class n extends r.a{constructor(e,t,s,r,i,n){super(),this.data=e,this.template=t,this.page=s,this.mainApi=r,this.newsCardList=i,this.savedNewsArray=n,this.setDataCard=this.setDataCard.bind(this),this._searchResultLoginAsk=this._searchResultLoginAsk.bind(this),this.renderIcon=this.renderIcon.bind(this),this._iconActive=this._iconActive.bind(this),this.saveArticle=this.saveArticle.bind(this),this.getDataToSaveArticle=this.getDataToSaveArticle.bind(this)}renderIcon(e){const t=this.page.querySelectorAll(".search-result__addIcon"),s=this.page.querySelectorAll(".search-result__deleteIcon");this.isLoggedIn=e,e&&t.length>0?t.forEach(e=>{e.classList.add("search-result__add-button"),this._iconActive(e)}):e&&s.length>0?s.forEach(e=>{e.classList.add("search-result__delete-button"),e.classList.add("search-result__add-button"),this._searchResultLoginAsk(e),this._iconActive(e)}):t.forEach(e=>{e.classList.add("search-result__add-button"),this._searchResultLoginAsk(e)})}_iconActive(e){e.addEventListener("click",()=>{if(e.classList.contains("search-result__add-button_active")||e.classList.contains("search-result__deleteIcon")){const t=e.closest(".search-result__card"),s=t.getAttribute("id");this.deleteArticle(s),e.classList.remove("search-result__add-button_active"),t.removeAttribute("id"),e.classList.contains("search-result__deleteIcon")&&t.remove()}else e.classList.add("search-result__add-button_active"),this.saveArticle(e)},!1)}_searchResultLoginAsk(e){this.mark=e,e.addEventListener("mouseover",e=>{e.target.previousElementSibling.previousElementSibling.classList.add("search-result__login-ask_on")}),e.addEventListener("mouseout",e=>{e.target.previousElementSibling.previousElementSibling.classList.remove("search-result__login-ask_on")})}createCard(){this.page.querySelector(".search-result__cards").append(this.page.getElementById("card-template").content.cloneNode(!0))}setDataCard(){const e=this.template.querySelector(".search-result__image"),t=this.template.querySelector(".search-result__date"),s=this.template.querySelector(".title__search-result-article"),r=this.template.querySelector(".subtitle__article"),n=this.template.querySelector(".search-result__source"),a=this.template.querySelector(".search-result__info-box"),o=this.template.querySelector(".search-result__tag_on");if(this.data._id)this.template.setAttribute("id",""+this.data._id),o.textContent=this.data.keyword,t.textContent=this.data.date,e.src=this.data.image,s.textContent=this.data.title,r.textContent=this.data.text,n.textContent=this.data.source,this.template.querySelector(".search-result__info-box").setAttribute("onclick",`'${this.data.link}'`);else{const o=this.data.publishedAt.value;e.src=this.data.urlToImage,t.textContent=Object(i.a)(o),s.textContent=this.data.title,r.textContent=this.data.description,n.textContent=this.data.source.name,a.setAttribute("onclick",`window.open('${this.data.url}')`)}}getDataToSaveArticle(e){const t=e.closest(".search-result__card");return{keyword:this.newsCardList.renderTopic().toString().toLowerCase(),image:t.querySelector(".search-result__image").src,date:t.querySelector(".search-result__date").textContent,title:t.querySelector(".title__search-result-article").textContent,text:t.querySelector(".subtitle__article").textContent,source:t.querySelector(".search-result__source").textContent,link:t.querySelector(".search-result__info-box").getAttribute("onclick").slice(13,-2)}}saveArticle(e){const t=e.closest(".search-result__card"),s=this.getDataToSaveArticle(t);this.mainApi.createArticle(s).then(e=>{t.setAttribute("id",""+e.data._id)}).catch(e=>{throw new Error(e)})}deleteArticle(e){this.mainApi.removeArticle(e).then(()=>{}).catch(e=>{throw new Error(e)})}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(0);class i{constructor(e){this.mainURL=e}signup(e){const{name:t,email:s,password:i}=e;return fetch(this.mainURL+"/signup",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({name:t,email:s,password:i})}).then(e=>r.a.errorThenStatus(e)).catch(e=>r.a.errorCatch(e))}signin(e){const{email:t,password:s}=e;return fetch(this.mainURL+"/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:s})}).then(e=>r.a.errorThenStatus(e)).catch(e=>r.a.errorCatch(e))}getUserData(){return fetch(this.mainURL+"/users/me",{headers:{authorization:"Bearer "+localStorage.getItem("token")},mode:"cors"}).then(e=>r.a.errorThenStatus(e)).catch(e=>r.a.errorCatch(e))}getArticles(){return fetch(this.mainURL+"/articles",{headers:{authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>r.a.errorThenStatus(e)).catch(e=>r.a.errorCatch(e))}createArticle(e){return fetch(this.mainURL+"/articles",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(e)}).then(e=>r.a.errorThenStatus(e)).catch(e=>r.a.errorCatch(e))}removeArticle(e){return fetch(`${this.mainURL}/articles/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>r.a.errorThenStatus(e)).catch(e=>r.a.errorCatch(e))}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(1);class i extends r.a{constructor(e,t,s,r,i,n){super(),this.container=e,this.cards=this.container.querySelector(".search-result__cards"),this.api=t,this.newsCard=r,this.page=i,this.isLoggedIn=n,this.getTopicSearch=s,this._showMore=this._showMore.bind(this),this._renderLoader=this._renderLoader.bind(this),this._renderNotFound=this._renderNotFound.bind(this),this._renderResults=this._renderResults.bind(this),this._renderError=this._renderError.bind(this),this._clearSearchResultBlock=this._clearSearchResultBlock.bind(this),this._openSearchResultBlock=this._openSearchResultBlock.bind(this),this.clearTopic=this.clearTopic.bind(this),this.newsArray=[],this.cardArr=document.querySelectorAll(".search-result__card"),this.temp=this.page.getElementById("card-template").content,this.card=this.temp.querySelector(".search-result__card"),this.buttonShowMore=this.page.getElementById("search-result-show-more")}searchingNews(){this.topic=this.renderTopic(),this._renderLoader(),this._renderShowMoreButton(),this.cardArr.length>0&&this._clearSearchResultBlock(),this.api.getNews(this.topic).then(e=>{this._openSearchResultBlock(),this._renderShowMoreButton(),e.forEach(e=>{this.newsArray.push(e)}),this._renderResults(this.newsArray),this._renderLoader()}).then(()=>{0===this.newsArray.length&&(this._openSearchResultBlock(),this._renderNotFound())}).catch(e=>{throw this._openSearchResultBlock(),this._renderLoader(),this._renderError(),new Error(e)})}_renderResults(e){this.news=e;let t;this.news.length>3?(t=this.news.splice(0,3),t.forEach(e=>{this.addCard(e)}),this.newCard.renderIcon(this.isLoggedIn),this._showMore(this.news)):(t=this.news,this.news.forEach(e=>{this.addCard(e)}))}_openSearchResultBlock(){this.page.getElementById("search-result-block").classList.toggle("search-result_on")}_renderLoader(){this.page.getElementById("preloader-searching").classList.toggle("preloader_on")}_renderNotFound(){this.page.getElementById("preloader-not-found").classList.toggle("preloader_on")}_renderShowMoreButton(){this.page.getElementById("search-result-show-more").classList.add("button__search-result_on")}renderTopic(){return this.topicValue=this.getTopicSearch.getValues(),this.topic=Object.values(this.topicValue),this.topic}clearTopic(){return this.topicValue=this.getTopicSearch.getValues(),this.topic=Object.values(this.topicValue),this.topic="",this.topic}_showMore(e){this._addListener(this.buttonShowMore,"click",t=>{t.stopImmediatePropagation(),this.newsArray.length<=3&&this.buttonShowMore.classList.remove("button__search-result_on"),this._renderResults(e)})}addCard(e){this.newCard=this.newsCard(e,this.card),this.newCard.setDataCard(this.isLoggedIn,this.card),this.newCard.createCard()}_renderError(){this.page.getElementById("search-result__error-text").textContent="Во время запроса произошла ошибка. Возможно, проблема с соединением или сервер недоступен. Подождите немного и попробуйте ещё раз"}_clearSearchResultBlock(){this._openSearchResultBlock(),this.cardArr.forEach(e=>{e.remove()})}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s(1);class i extends r.a{constructor(e){super(),this.page=e,this.buttonAuth=this.page.getElementById("open-popupEnter"),this.buttonSaved=this.page.querySelector(".header__button_saved"),this.buttonWithName=this.page.querySelector(".header__button_name"),this.userName=this.page.querySelector(".button__selected_with-name"),this.userNameBorder=this.page.querySelector(".header__button_name"),this.logoutButton=this.page.querySelector(".button__logout"),this.buttonCloseMobileMenu=this.page.querySelector(".header__menu-mobile_close"),this.buttonMobileMenuMain=this.page.getElementById("header__menu-mobile-main-page"),this.mobileMenuMain=this.page.querySelector(".header__buttons"),this.headerMenu=this.page.querySelector(".header__menu"),this.headerLogo=this.page.querySelector(".header__logo"),this.addCloseButtonHeader=this.page.querySelector(".header__menu-mobile_close"),this.underlineBlack=this.page.getElementById("underline"),this.buttonMain=this.page.querySelectorAll(".button__main"),this.headerInfo=this.page.querySelector(".header__info"),this.searchResult=this.page.querySelector(".search-result"),this.buttonMobileMenuArticles=this.page.getElementById("header__menu-mobile-articles-page")}mobileMenuMainOpen(){this.mobileMenuMain.classList.add("header__buttons_open"),this.headerMenu.classList.add("header_dark"),this.buttonMobileMenuMain.classList.add("header__menu-mobile_off"),this.addCloseButtonHeader.classList.add("header__menu-mobile_on"),this.headerInfo.classList.add("header__info_filter"),this.searchResult.classList.add("search-result_filter")}mobileMenuMainClose(){this.mobileMenuMain.classList.toggle("header__buttons_open"),this.headerMenu.classList.toggle("header_dark"),this.buttonMobileMenuMain.classList.toggle("header__menu-mobile_off"),this.buttonCloseMobileMenu.classList.remove("header__menu-mobile_on"),this.headerInfo.classList.remove("header__info_filter"),this.searchResult.classList.remove("search-result_filter")}mobileMenuArticlesOpen(){this.mobileMenuMain.classList.add("header__buttons_open"),this.headerMenu.classList.add("header_dark"),this.headerLogo.classList.add("button_white"),this.buttonMain.forEach(e=>{e.classList.remove("button_black")}),this.userName.classList.remove("button_black"),this.userNameBorder.classList.remove("button__selected_black"),this.logoutButton.classList.remove("button__logout_black"),this.buttonMobileMenuArticles.classList.add("header__menu-mobile_off"),this.addCloseButtonHeader.classList.add("header__menu-mobile_on"),this.underlineBlack.classList.remove("header__button_underline-black"),this.searchResult.classList.add("search-result_filter")}mobileMenuArticlesClose(){this.mobileMenuMain.classList.remove("header__buttons_open"),this.headerMenu.classList.remove("header_dark"),this.headerLogo.classList.remove("button_white"),this.buttonMain.forEach(e=>{e.classList.add("button_black")}),this.userName.classList.add("button_black"),this.logoutButton.classList.add("button__logout_black"),this.userNameBorder.classList.add("button__selected_black"),this.buttonMobileMenuArticles.classList.remove("header__menu-mobile_off"),this.addCloseButtonHeader.classList.remove("header__menu-mobile_on"),this.underlineBlack.classList.remove("header__button_underline-black"),this.headerInfo.classList.add("header__info_filter"),this.searchResult.classList.remove("search-result_filter")}render(e,t){e&&(this.buttonWithName&&this.buttonSaved&&this.buttonAuth?(this.buttonWithName.classList.remove("header__button_off"),this.buttonSaved.classList.remove("header__button_off"),this.buttonAuth.classList.add("header__button_off"),this.userName.textContent=t):this.userName.textContent=t)}logOut(){localStorage.removeItem("token"),window.location.reload()}}},function(e,t,s){"use strict";const r={API_KEY:"634478c6149d4c42876b31c990303727",NEWS_URL:"https://nomoreparties.co/news/v2/everything",MAIN_URL:"https://api.elena-k.tk",TOKEN:localStorage.getItem("token"),PAGE:document,TEMPLATE:document.getElementById("card-template")};t.a=r},function(e,t,s){},,function(e,t,s){"use strict";s.r(t);s(8);var r=s(4),i=s(0);class n{constructor(e,t,s,r){this.apiKey=t,this.newsUrl=e,this.dateMin=s,this.dateMax=r}getNews(e){return fetch(`${this.newsUrl}?q=${e}&from=${this.dateMin}&to=${this.dateMax}&sortBy=date&language=ru&pageSize=100&apiKey=${this.apiKey}`).then(e=>e.json()).then(e=>e.articles).catch(e=>i.a.errorCatch(e))}}var a=s(1);class o extends a.a{constructor(e){super(),this.elenent=e}open(){this.elenent.classList.add("popup_is-opened")}close(){this.elenent.classList.remove("popup_is-opened")}}var c={INCORRECT_EMAIL:"Неправильный формат email",INCORRECT_EMAIL_LENGTH:"Введите пароль от 8 до 30 символов",REQUIRED_FIELD:"Обязательное поле",SERVER_ERR_409:"Такой пользователь уже есть",SERVER_ERR_401:"Неправильные логин или пароль",SERVER_ERR_400:"Проверьте правильность введенных данных",SEARCH_ERROR:"Нужно ввести ключевое слово"};const{INCORRECT_EMAIL:h,INCORRECT_EMAIL_LENGTH:l,REQUIRED_FIELD:d,SERVER_ERR_409:u,SERVER_ERR_401:_,SERVER_ERR_400:m,SEARCH_ERROR:p}=c;class g extends a.a{constructor(e,t,s,r,i){super(),this.form=e,this.api=t,this.popup=s,this.card=r,this.popupUserAdded=i,this.buttonSubmit=this.form.querySelector(".button"),this._validateForm=this._validateForm.bind(this),this._validateInputs=this._validateInputs.bind(this),this.getInfo=this.getInfo.bind(this),this._cleanErrors=this._cleanErrors.bind(this),this._cleanInputs=this._cleanInputs.bind(this),this.getValues=this.getValues.bind(this),this.form.addEventListener("submit",e=>this.submitForm(e)),this.reset=this.reset.bind(this),this._setServerError=this._setServerError.bind(this),this.isLoggedIn=!1}getValues(){const e={};return Array.from(this.form.elements).forEach(t=>{"INPUT"===t.nodeName&&(e[t.name]=t.value)}),e}getInfo(){const e=[];return Array.from(this.form.elements).forEach(t=>{"INPUT"===t.nodeName&&(e.push(t),this._addListener(this.input,"input",this._validateInputs()))}),e}setEventListeners(){this._addListener(this.form,"input",this._validateForm)}submitForm(e){e.preventDefault(),"form-registration"===e.target.getAttribute("id")?this.api.signup(this.getValues()).then(()=>{this.popup.close(),this.popupUserAdded.open(),this.reset(),this.isLoggedIn=!1}).catch(e=>{throw new Error(e)}):"form-enter"===e.target.getAttribute("id")&&this.api.signin(this.getValues()).then(e=>{this.popup.close(),this.reset(),this.isLoggedIn=!0,localStorage.setItem("token",e.token),window.location.reload()}).catch(e=>{this._setServerError(e),this.isLoggedIn=!1})}_setServerError(e){const t=this.buttonSubmit.previousElementSibling;400===e?t.textContent=m:401===e?t.textContent=_:409===e&&(t.textContent=u)}_validateInputs(){let e=!0;return this.form.querySelectorAll("input").forEach(t=>{const s=t.nextElementSibling;"email"!==t.name||t.validity.valid?"password"!==t.name||t.validity.valid?"name"!==t.name||t.validity.valid?"search"!==t.name||t.validity.valid?t.validity.valid&&(s.textContent=""):(s.textContent=p,e=!1):(s.textContent=d,e=!1):(s.textContent=l,e=!1):(s.textContent=h,e=!1)}),e}_validateForm(){this._validateInputs()?this.buttonSubmit.disabled=!1:this.buttonSubmit.disabled=!0}_cleanErrors(){this.form.querySelectorAll("input").forEach(e=>{e.nextElementSibling.textContent=""})}_cleanInputs(){this.form.querySelectorAll("input").forEach(e=>{e.value=""}),this.buttonSubmit.disabled=!0}reset(){this._cleanErrors(),this._cleanInputs()}}var b=s(3),E=s(5),f=s(6),L=s(7),v=s(2);(()=>{const{API_KEY:e,NEWS_URL:t,MAIN_URL:s,TOKEN:i,PAGE:a,TEMPLATE:c}=L.a,h=Object(v.b)(Object(v.c)()),l=Object(v.b)(Object(v.d)()),d=document.querySelectorAll(".popup__close"),u=document.querySelector(".button__logout"),_=document.getElementById("open-popupEnter"),m=document.getElementById("open-popupRegistration"),p=document.getElementById("form-enter"),S=document.getElementById("form-search"),y=document.getElementById("form-registration"),I=document.getElementById("search-button"),w=document.getElementById("header__menu-mobile-main-page"),R=document.querySelector(".header__menu-mobile_close"),A=document.getElementById("popup__other"),C=document.querySelector(".popup__other-registration_added");let M=!1;const k=new r.a(s),B=new n(t,e,h,l),T=new o(document.getElementById("popup__enter")),x=new o(document.getElementById("popupRegistration")),q=new o(document.getElementById("popupUserAdded")),N=new b.a("",c,""),O=new g(p,k,T,N,""),D=new g(y,k,x,N,q),j=new g(S,"",""),U=new f.a(a);i&&k.getUserData(i).then(e=>{M=!0,U.render(M,e.name)}).catch(()=>{M=!1,U.render(M,"")}),j.setEventListeners(),C.addEventListener("click",()=>{q.close(),T.open(T),O.setEventListeners(),R.classList.remove("header__menu-mobile_on")}),w.addEventListener("click",()=>{U.mobileMenuMainOpen()}),R.addEventListener("click",()=>{U.mobileMenuMainClose()}),d.forEach(e=>{e.addEventListener("click",()=>{T.close(),x.close(),q.close(),O.reset(),D.reset(),w.classList.toggle("header__menu-mobile_off")})}),document.addEventListener("keyup",e=>{e.preventDefault(),"Escape"===e.code&&(T.close(),x.close(),q.close(),O.reset(),D.reset())}),_.addEventListener("click",()=>{T.open(T),O.setEventListeners(),R.classList.remove("header__menu-mobile_on")}),m.addEventListener("click",()=>{T.close(T),x.open(x),D.setEventListeners(),A.addEventListener("click",()=>{x.close(),D.reset(),T.open(T)})}),I.addEventListener("click",()=>{const e=new E.a(c,B,j,(t,s)=>new b.a(t,s,a,k,e,""),a,M);e.searchingNews()}),u.addEventListener("click",()=>{U.logOut()})})()}]);