!function(e){var t={};function r(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(s,a,function(t){return e[t]}.bind(null,a));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=11)}([function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));class s{static errorCatch(e){return Promise.reject(e)}static errorThen(e){return e.ok?e.json():Promise.reject(e)}static errorThenStatus(e){return e.ok?e.json():Promise.reject(e.status)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));class s{constructor(){this._listeners=[]}_addListener(e,t,r){this.element=e,e.addEventListener(t,r)}_setListeners(e){e.forEach(e=>{this._addListener(...e)})}_removeListeners(){this._listeners.forEach(e=>{const{element:t,event:r,callback:s}=e;t.removeEventListener(r,s)})}}},function(e,t,r){"use strict";r.d(t,"c",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"d",(function(){return n})),r.d(t,"a",(function(){return i}));const s=()=>new Date(Date.now()-6048e5),a=e=>`${new Intl.DateTimeFormat("ru",{year:"numeric"}).format(e)}-${new Intl.DateTimeFormat("ru",{month:"numeric"}).format(e)}-${new Intl.DateTimeFormat("ru",{day:"numeric"}).format(e)}`,n=()=>new Date,i=e=>`${new Intl.DateTimeFormat("ru",{day:"numeric"}).format(e)} ${new Intl.DateTimeFormat("ru",{month:"long"}).format(e)}, ${new Intl.DateTimeFormat("ru",{year:"numeric"}).format(e)}`},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r(1),a=r(2);class n extends s.a{constructor(e,t,r,s,a,n){super(),this.data=e,this.template=t,this.page=r,this.mainApi=s,this.newsCardList=a,this.savedNewsArray=n,this.setDataCard=this.setDataCard.bind(this),this._searchResultLoginAsk=this._searchResultLoginAsk.bind(this),this.renderIcon=this.renderIcon.bind(this),this._iconActive=this._iconActive.bind(this),this.saveArticle=this.saveArticle.bind(this),this.getDataToSaveArticle=this.getDataToSaveArticle.bind(this)}renderIcon(e){const t=this.page.querySelectorAll(".search-result__addIcon"),r=this.page.querySelectorAll(".search-result__deleteIcon");this.isLoggedIn=e,e&&t.length>0?t.forEach(e=>{e.classList.add("search-result__add-button"),this._iconActive(e)}):e&&r.length>0?r.forEach(e=>{e.classList.add("search-result__delete-button"),e.classList.add("search-result__add-button"),this._searchResultLoginAsk(e),this._iconActive(e)}):t.forEach(e=>{e.classList.add("search-result__add-button"),this._searchResultLoginAsk(e)})}_iconActive(e){e.addEventListener("click",()=>{if(e.classList.contains("search-result__add-button_active")||e.classList.contains("search-result__deleteIcon")){const t=e.closest(".search-result__card"),r=t.getAttribute("id");this.deleteArticle(r),e.classList.remove("search-result__add-button_active"),t.removeAttribute("id"),e.classList.contains("search-result__deleteIcon")&&t.remove()}else e.classList.add("search-result__add-button_active"),this.saveArticle(e)},!1)}_searchResultLoginAsk(e){this.mark=e,e.addEventListener("mouseover",e=>{e.target.previousElementSibling.previousElementSibling.classList.add("search-result__login-ask_on")}),e.addEventListener("mouseout",e=>{e.target.previousElementSibling.previousElementSibling.classList.remove("search-result__login-ask_on")})}createCard(){this.page.querySelector(".search-result__cards").append(this.page.getElementById("card-template").content.cloneNode(!0))}setDataCard(){const e=this.template.querySelector(".search-result__image"),t=this.template.querySelector(".search-result__date"),r=this.template.querySelector(".title__search-result-article"),s=this.template.querySelector(".subtitle__article"),n=this.template.querySelector(".search-result__source"),i=this.template.querySelector(".search-result__info-box"),o=this.template.querySelector(".search-result__tag_on");if(this.data._id)this.template.setAttribute("id",""+this.data._id),o.textContent=this.data.keyword,t.textContent=this.data.date,e.src=this.data.image,r.textContent=this.data.title,s.textContent=this.data.text,n.textContent=this.data.source,this.template.querySelector(".search-result__info-box").setAttribute("onclick",`'${this.data.link}'`);else{const o=this.data.publishedAt.value;e.src=this.data.urlToImage,t.textContent=Object(a.a)(o),r.textContent=this.data.title,s.textContent=this.data.description,n.textContent=this.data.source.name,i.setAttribute("onclick",`window.open('${this.data.url}')`)}}getDataToSaveArticle(e){const t=e.closest(".search-result__card");return{keyword:this.newsCardList.renderTopic().toString().toLowerCase(),image:t.querySelector(".search-result__image").src,date:t.querySelector(".search-result__date").textContent,title:t.querySelector(".title__search-result-article").textContent,text:t.querySelector(".subtitle__article").textContent,source:t.querySelector(".search-result__source").textContent,link:t.querySelector(".search-result__info-box").getAttribute("onclick").slice(13,-2)}}saveArticle(e){const t=e.closest(".search-result__card"),r=this.getDataToSaveArticle(t);this.mainApi.createArticle(r).then(e=>{t.setAttribute("id",""+e.data._id)}).catch(e=>{throw new Error(e)})}deleteArticle(e){this.mainApi.removeArticle(e).then(()=>{}).catch(e=>{throw new Error(e)})}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var s=r(0);class a{constructor(e){this.mainURL=e}signup(e){const{name:t,email:r,password:a}=e;return fetch(this.mainURL+"/signup",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({name:t,email:r,password:a})}).then(e=>s.a.errorThenStatus(e)).catch(e=>s.a.errorCatch(e))}signin(e){const{email:t,password:r}=e;return fetch(this.mainURL+"/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})}).then(e=>s.a.errorThenStatus(e)).catch(e=>s.a.errorCatch(e))}getUserData(){return fetch(this.mainURL+"/users/me",{headers:{authorization:"Bearer "+localStorage.getItem("token")},mode:"cors"}).then(e=>s.a.errorThenStatus(e)).catch(e=>s.a.errorCatch(e))}getArticles(){return fetch(this.mainURL+"/articles",{headers:{authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>s.a.errorThenStatus(e)).catch(e=>s.a.errorCatch(e))}createArticle(e){return fetch(this.mainURL+"/articles",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(e)}).then(e=>s.a.errorThenStatus(e)).catch(e=>s.a.errorCatch(e))}removeArticle(e){return fetch(`${this.mainURL}/articles/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>s.a.errorThenStatus(e)).catch(e=>s.a.errorCatch(e))}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var s=r(1);class a extends s.a{constructor(e,t,r,s,a,n){super(),this.container=e,this.cards=this.container.querySelector(".search-result__cards"),this.api=t,this.newsCard=s,this.page=a,this.isLoggedIn=n,this.getTopicSearch=r,this._showMore=this._showMore.bind(this),this._renderLoader=this._renderLoader.bind(this),this._renderNotFound=this._renderNotFound.bind(this),this._renderResults=this._renderResults.bind(this),this._renderError=this._renderError.bind(this),this._clearSearchResultBlock=this._clearSearchResultBlock.bind(this),this._openSearchResultBlock=this._openSearchResultBlock.bind(this),this.clearTopic=this.clearTopic.bind(this),this.newsArray=[],this.cardArr=document.querySelectorAll(".search-result__card"),this.temp=this.page.getElementById("card-template").content,this.card=this.temp.querySelector(".search-result__card"),this.buttonShowMore=this.page.getElementById("search-result-show-more")}searchingNews(){this.topic=this.renderTopic(),this._renderLoader(),this._renderShowMoreButton(),this.cardArr.length>0&&this._clearSearchResultBlock(),this.api.getNews(this.topic).then(e=>{this._openSearchResultBlock(),this._renderShowMoreButton(),e.forEach(e=>{this.newsArray.push(e)}),this._renderResults(this.newsArray),this._renderLoader()}).then(()=>{0===this.newsArray.length&&(this._openSearchResultBlock(),this._renderNotFound())}).catch(e=>{throw this._openSearchResultBlock(),this._renderLoader(),this._renderError(),new Error(e)})}_renderResults(e){this.news=e;let t;this.news.length>3?(t=this.news.splice(0,3),t.forEach(e=>{this.addCard(e)}),this.newCard.renderIcon(this.isLoggedIn),this._showMore(this.news)):(t=this.news,this.news.forEach(e=>{this.addCard(e)}))}_openSearchResultBlock(){this.page.getElementById("search-result-block").classList.toggle("search-result_on")}_renderLoader(){this.page.getElementById("preloader-searching").classList.toggle("preloader_on")}_renderNotFound(){this.page.getElementById("preloader-not-found").classList.toggle("preloader_on")}_renderShowMoreButton(){this.page.getElementById("search-result-show-more").classList.add("button__search-result_on")}renderTopic(){return this.topicValue=this.getTopicSearch.getValues(),this.topic=Object.values(this.topicValue),this.topic}clearTopic(){return this.topicValue=this.getTopicSearch.getValues(),this.topic=Object.values(this.topicValue),this.topic="",this.topic}_showMore(e){this._addListener(this.buttonShowMore,"click",t=>{t.stopImmediatePropagation(),this.newsArray.length<=3&&this.buttonShowMore.classList.remove("button__search-result_on"),this._renderResults(e)})}addCard(e){this.newCard=this.newsCard(e,this.card),this.newCard.setDataCard(this.isLoggedIn,this.card),this.newCard.createCard()}_renderError(){this.page.getElementById("search-result__error-text").textContent="Во время запроса произошла ошибка. Возможно, проблема с соединением или сервер недоступен. Подождите немного и попробуйте ещё раз"}_clearSearchResultBlock(){this._openSearchResultBlock(),this.cardArr.forEach(e=>{e.remove()})}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var s=r(1);class a extends s.a{constructor(e){super(),this.page=e,this.buttonAuth=this.page.getElementById("open-popupEnter"),this.buttonSaved=this.page.querySelector(".header__button_saved"),this.buttonWithName=this.page.querySelector(".header__button_name"),this.userName=this.page.querySelector(".button__selected_with-name"),this.userNameBorder=this.page.querySelector(".header__button_name"),this.logoutButton=this.page.querySelector(".button__logout"),this.buttonCloseMobileMenu=this.page.querySelector(".header__menu-mobile_close"),this.buttonMobileMenuMain=this.page.getElementById("header__menu-mobile-main-page"),this.mobileMenuMain=this.page.querySelector(".header__buttons"),this.headerMenu=this.page.querySelector(".header__menu"),this.headerLogo=this.page.querySelector(".header__logo"),this.addCloseButtonHeader=this.page.querySelector(".header__menu-mobile_close"),this.underlineBlack=this.page.getElementById("underline"),this.buttonMain=this.page.querySelectorAll(".button__main"),this.headerInfo=this.page.querySelector(".header__info"),this.searchResult=this.page.querySelector(".search-result"),this.buttonMobileMenuArticles=this.page.getElementById("header__menu-mobile-articles-page")}mobileMenuMainOpen(){this.mobileMenuMain.classList.add("header__buttons_open"),this.headerMenu.classList.add("header_dark"),this.buttonMobileMenuMain.classList.add("header__menu-mobile_off"),this.addCloseButtonHeader.classList.add("header__menu-mobile_on"),this.headerInfo.classList.add("header__info_filter"),this.searchResult.classList.add("search-result_filter")}mobileMenuMainClose(){this.mobileMenuMain.classList.toggle("header__buttons_open"),this.headerMenu.classList.toggle("header_dark"),this.buttonMobileMenuMain.classList.toggle("header__menu-mobile_off"),this.buttonCloseMobileMenu.classList.remove("header__menu-mobile_on"),this.headerInfo.classList.remove("header__info_filter"),this.searchResult.classList.remove("search-result_filter")}mobileMenuArticlesOpen(){this.mobileMenuMain.classList.add("header__buttons_open"),this.headerMenu.classList.add("header_dark"),this.headerLogo.classList.add("button_white"),this.buttonMain.forEach(e=>{e.classList.remove("button_black")}),this.userName.classList.remove("button_black"),this.userNameBorder.classList.remove("button__selected_black"),this.logoutButton.classList.remove("button__logout_black"),this.buttonMobileMenuArticles.classList.add("header__menu-mobile_off"),this.addCloseButtonHeader.classList.add("header__menu-mobile_on"),this.underlineBlack.classList.remove("header__button_underline-black"),this.searchResult.classList.add("search-result_filter")}mobileMenuArticlesClose(){this.mobileMenuMain.classList.remove("header__buttons_open"),this.headerMenu.classList.remove("header_dark"),this.headerLogo.classList.remove("button_white"),this.buttonMain.forEach(e=>{e.classList.add("button_black")}),this.userName.classList.add("button_black"),this.logoutButton.classList.add("button__logout_black"),this.userNameBorder.classList.add("button__selected_black"),this.buttonMobileMenuArticles.classList.remove("header__menu-mobile_off"),this.addCloseButtonHeader.classList.remove("header__menu-mobile_on"),this.underlineBlack.classList.remove("header__button_underline-black"),this.headerInfo.classList.add("header__info_filter"),this.searchResult.classList.remove("search-result_filter")}render(e,t){e&&(this.buttonWithName&&this.buttonSaved&&this.buttonAuth?(this.buttonWithName.classList.remove("header__button_off"),this.buttonSaved.classList.remove("header__button_off"),this.buttonAuth.classList.add("header__button_off"),this.userName.textContent=t):this.userName.textContent=t)}logOut(){localStorage.removeItem("token"),window.location.reload()}}},function(e,t,r){"use strict";const s={API_KEY:"634478c6149d4c42876b31c990303727",NEWS_URL:"https://nomoreparties.co/news/v2/everything",MAIN_URL:"https://api.elena-k.tk",TOKEN:localStorage.getItem("token"),PAGE:document,TEMPLATE:document.getElementById("card-template")};t.a=s},,function(e,t,r){},,function(e,t,r){"use strict";r.r(t);r(9);var s=r(4),a=r(6),n=r(7),i=r(3),o=r(5);var c={bigLetter:e=>e.charAt(0).toUpperCase()+e.slice(1)};(()=>{const{MAIN_URL:e,TOKEN:t,PAGE:r,TEMPLATE:h}=n.a,{bigLetter:l}=c,d=new s.a(e);let u=!0;const _=[],m=[],g=document.getElementById("header__menu-mobile-articles-page"),b=document.querySelector(".header__menu-mobile_close"),p=document.querySelector(".button__logout"),f=new a.a(r),L=new o.a(h,"","",(e,t)=>new i.a(e,t,r,d,L,_),r,u),y=new i.a("","",r,d,"",""),S=document.getElementById("header__info_amoumt-articles"),v=document.getElementById("header__info-name"),w=document.getElementById("header__tag-main"),C=document.getElementById("header__tag-second"),E=document.getElementById("header__tag-other"),A=document.getElementById("header__tag-comma"),k=document.getElementById("header__tag-and"),M=document.getElementById("header__tag-word");function I(e){S.textContent=e}t?d.getUserData(t).then(e=>{u=!0,f.render(u,e.name),v.textContent=e.name}).catch(()=>{u=!1,f.render(u,"")}):document.location.replace("./index.html"),g.addEventListener("click",()=>{f.mobileMenuArticlesOpen()}),b.addEventListener("click",()=>{f.mobileMenuArticlesClose()}),p.addEventListener("click",()=>{f.logOut()}),d.getArticles().then(e=>{e.data.forEach(e=>{_.push(e),m.push(e.keyword)})}).then(()=>{0===_.length?I(_.length):_.length>0&&(I(_.length),L._openSearchResultBlock(),_.forEach(e=>{L.addCard(e)}),y.renderIcon(u))}).catch(e=>{throw new Error(e)}),setTimeout(()=>{const e=m.reduce((e,t)=>(e[t]||(e[t]=0),e[t]++,e),{}),t=Object.entries(e).sort(([,e],[,t])=>t-e).reduce((e,[t,r])=>({...e,[t]:r}),{}),r=Object.keys(t);r.length>3?(w.textContent=l(r[0]),C.textContent=l(r[1]),E.textContent=r.length-2,A.textContent=",",k.textContent="и",M.textContent="другим"):3===r.length?(w.textContent=l(r[0]),C.textContent=l(r[1]),E.textContent=l(r[2]),A.textContent=",",k.textContent="и"):2===r.length?(w.textContent=l(r[0]),C.textContent=l(r[1]),A.textContent=","):1===r.length&&(w.textContent=l(r[0]))},1e3)})()}]);