!function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){},,,function(e,t,r){"use strict";r.r(t);r(0);class s{static errorCatch(e){return Promise.reject(e)}static errorThen(e){return e.ok?e.json():Promise.reject(e)}static errorThenStatus(e){return e.ok?e.json():Promise.reject(e.status)}}class n{constructor(){this._listeners=[]}_addListener(e,t,r){this.element=e,e.addEventListener(t,r)}_setListeners(e){e.forEach(e=>{this._addListener(...e)})}_removeListeners(){this._listeners.forEach(e=>{const{element:t,event:r,callback:s}=e;t.removeEventListener(r,s)})}}class i extends n{constructor(e){super(),this.elenent=e}open(){this.elenent.classList.add("popup_is-opened")}close(){this.elenent.classList.remove("popup_is-opened")}}var a={INCORRECT_EMAIL:"Неправильный формат email",INCORRECT_EMAIL_LENGTH:"Введите пароль от 8 до 30 символов",REQUIRED_FIELD:"Обязательное поле",SERVER_ERR_409:"Такой пользователь уже есть",SERVER_ERR_401:"Неправильные логин или пароль",SERVER_ERR_400:"Проверьте правильность введенных данных",SEARCH_ERROR:"Нужно ввести ключевое слово"};const{INCORRECT_EMAIL:o,INCORRECT_EMAIL_LENGTH:h,REQUIRED_FIELD:c,SERVER_ERR_409:l,SERVER_ERR_401:d,SERVER_ERR_400:u,SEARCH_ERROR:m}=a;class _ extends n{constructor(e,t,r,s){super(),this.form=e,this.api=t,this.popup=r,this.card=s,this.buttonSubmit=this.form.querySelector(".button"),this._validateForm=this._validateForm.bind(this),this._validateInputs=this._validateInputs.bind(this),this.getInfo=this.getInfo.bind(this),this._cleanErrors=this._cleanErrors.bind(this),this._cleanInputs=this._cleanInputs.bind(this),this.getValues=this.getValues.bind(this),this.form.addEventListener("submit",e=>this.submitForm(e)),this.reset=this.reset.bind(this),this._setServerError=this._setServerError.bind(this),this.isLoggedIn=!1}getValues(){const e={};return Array.from(this.form.elements).forEach(t=>{"INPUT"===t.nodeName&&(e[t.name]=t.value)}),e}getInfo(){const e=[];return Array.from(this.form.elements).forEach(t=>{"INPUT"===t.nodeName&&(e.push(t),this._addListener(this.input,"input",this._validateInputs()))}),e}setEventListeners(){this._addListener(this.form,"input",this._validateForm)}submitForm(e){e.preventDefault(),"form-registration"===e.target.getAttribute("id")?this.api.signup(this.getValues()).then(()=>{this.popup.close(),this.reset(),this.isLoggedIn=!1,this.card.renderIcon(this.isLoggedIn)}).catch(e=>{throw new Error(e)}):"form-enter"===e.target.getAttribute("id")&&this.api.signin(this.getValues()).then(()=>{this.popup.close(),this.reset(),this.isLoggedIn=!0,console.log(localStorage.getItem("token")),console.log(localStorage),this.card.renderIcon(this.isLoggedIn)}).catch(e=>{this._setServerError(e),this.isLoggedIn=!1,this.card.renderIcon(this.isLoggedIn)})}_setServerError(e){const t=this.buttonSubmit.previousElementSibling;400===e?t.textContent=u:401===e?t.textContent=d:409===e&&(t.textContent=l)}_validateInputs(){let e=!0;return this.form.querySelectorAll("input").forEach(t=>{const r=t.nextElementSibling;"email"!==t.name||t.validity.valid?"password"!==t.name||t.validity.valid?"name"!==t.name||t.validity.valid?"search"!==t.name||t.validity.valid?t.validity.valid&&(r.textContent=""):(r.textContent=m,e=!1):(r.textContent=c,e=!1):(r.textContent=h,e=!1):(r.textContent=o,e=!1)}),e}_validateForm(){this._validateInputs()?this.buttonSubmit.disabled=!1:this.buttonSubmit.disabled=!0}_cleanErrors(){this.form.querySelectorAll("input").forEach(e=>{e.nextElementSibling.textContent=""})}_cleanInputs(){this.form.querySelectorAll("input").forEach(e=>{e.value=""}),this.buttonSubmit.disabled=!0}reset(){this._cleanErrors(),this._cleanInputs()}}const p=e=>`${new Intl.DateTimeFormat("ru",{year:"numeric"}).format(e)}-${new Intl.DateTimeFormat("ru",{month:"numeric"}).format(e)}-${new Intl.DateTimeFormat("ru",{day:"numeric"}).format(e)}`;class g extends n{constructor(e,t,r){super(),this.data=e,this.template=t,this.page=r,this.setDataCard=this.setDataCard.bind(this),this.searchResultLoginAsk=this.searchResultLoginAsk.bind(this),this.cardMark=this.template.querySelector(".search-result__add-button")}renderIcon(e){this.isLoggedIn=e,e?(console.log(this.cardMark),this.cardMark.hasClass("active")&&console.log("has class active")):this.cardMark.hasClass("active")&&console.log("has active no log")}searchResultLoginAsk(){this.page.querySelectorAll(".search-result__card").forEach(e=>{const t=e.querySelector(".search-result__add-button"),r=e.querySelector(".search-result__login-ask");t.addEventListener("mouseover",()=>{r.classList.add("search-result__login-ask_on")}),t.addEventListener("mouseout",()=>{r.classList.remove("search-result__login-ask_on")})})}createCard(){this.page.querySelector(".search-result__cards").append(this.page.getElementById("card-template").content.cloneNode(!0))}setDataCard(){const e=this.data.publishedAt.value;this.template.querySelector(".search-result__image").src=this.data.urlToImage,this.template.querySelector(".search-result__date").textContent=(e=>`${new Intl.DateTimeFormat("ru",{day:"numeric"}).format(e)} ${new Intl.DateTimeFormat("ru",{month:"long"}).format(e)}, ${new Intl.DateTimeFormat("ru",{year:"numeric"}).format(e)}`)(e),this.template.querySelector(".title__search-result-article").textContent=this.data.title,this.template.querySelector(".subtitle__article").textContent=this.data.description,this.template.querySelector(".search-result__source").textContent=this.data.source.name,this.template.querySelector(".search-result__add-button").src=""}}class E extends n{constructor(e,t,r,s,n){super(),this.container=e,this.cards=this.container.querySelector(".search-result__cards"),this.api=t,this.newsCard=s,this.page=n,this.getTopicSearch=r,this.showMore=this.showMore.bind(this),this.renderLoader=this.renderLoader.bind(this),this.renderNotFound=this.renderNotFound.bind(this),this.renderResults=this.renderResults.bind(this),this.renderError=this.renderError.bind(this),this.newsArray=[],this.temp=this.page.getElementById("card-template").content,this.card=this.temp.querySelector(".search-result__card")}searchingNews(){this.topic=this.renderTopic(),this.api.getNews(this.topic).then(e=>(setTimeout(()=>{this.renderLoader()},1e3),e)).then(e=>{this.renderLoader(),this.openSearchResultBlock(),this.renderShowMoreButton(),e.forEach(e=>{this.newsArray.push(e)}),this.renderResults()}).then(()=>{0===this.newsArray.length&&(this.openSearchResultBlock(),setTimeout(()=>{this.renderNotFound()},1001))}).catch(e=>{throw this.openSearchResultBlock(),this.renderError(),new Error(e)})}renderResults(){let e;this.newsArray.length>3&&(e=this.newsArray.splice(0,3),e.forEach(e=>{this.addCard(e),this.newCard.searchResultLoginAsk()}),this.showMore())}openSearchResultBlock(){this.page.getElementById("search-result-block").classList.toggle("search-result_on")}renderLoader(){this.page.getElementById("preloader-searching").classList.toggle("preloader_on")}renderNotFound(){this.page.getElementById("preloader-not-found").classList.toggle("preloader_on")}renderShowMoreButton(){this.page.getElementById("search-result-show-more").classList.toggle("button__search-result_on")}renderTopic(){return this.topicValue=this.getTopicSearch.getValues(),this.topic=Object.values(this.topicValue),this.topic}showMore(){const e=this.page.getElementById("search-result-show-more");this._addListener(e,"click",t=>{t.stopImmediatePropagation(),this.newsArray.length<=3&&e.classList.remove("button__search-result_on"),this.renderResults()})}addCard(e){this.newCard=this.newsCard(e,this.card),this.newCard.setDataCard(),this.newCard.createCard(),this.newCard.searchResultLoginAsk()}renderError(){this.page.getElementById("search-result__error-text").textContent="Во время запроса произошла ошибка. Возможно, проблема с соединением или сервер недоступен. Подождите немного и попробуйте ещё раз"}}var f={API_KEY:"634478c6149d4c42876b31c990303727",NEWS_URL:"https://newsapi.org/v2/everything",MAIN_URL:"https://api.elena-k.tk"};const{API_KEY:y,NEWS_URL:L,MAIN_URL:S}=f,b=p(new Date(Date.now()-6048e5)),I=p(new Date),v=new class{constructor(e){this.mainURL=e}signup(e){const{name:t,email:r,password:n}=e;return fetch(this.mainURL+"/signup",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({name:t,email:r,password:n})}).then(e=>s.errorThenStatus(e)).catch(e=>s.errorCatch(e))}signin(e){const{email:t,password:r}=e;return fetch(this.mainURL+"/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})}).then(e=>s.errorThenStatus(e)).catch(e=>s.errorCatch(e))}getUserData(){return fetch(this.mainURL+"/users/me",{headers:{authorization:"Bearer "+localStorage.getItem("token")},mode:"cors"}).then(e=>s.errorThenStatus(e)).catch(e=>s.errorCatch(e))}getArticles(){return fetch(this.mainURL+"/articles",{headers:{authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>s.errorThenStatus(e)).catch(e=>s.errorCatch(e))}createArticle(e){return fetch(this.mainURL+"/articles",{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer "+localStorage.getItem("token")},body:JSON.stringify(e)}).then(e=>s.errorThenStatus(e)).catch(e=>s.errorCatch(e))}removeArticle(e){return fetch(`${this.mainURL}/articles/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",authorization:"Bearer "+localStorage.getItem("token")}}).then(e=>s.errorThenStatus(e)).catch(e=>s.errorCatch(e))}}(S),R=new class{constructor(e,t,r,s){this.apiKey=t,this.newsUrl=e,this.dateMin=r,this.dateMax=s}getNews(e){return fetch(`${this.newsUrl}?q=${e}&from=${this.dateMin}&to=${this.dateMax}&sortBy=date&language=ru&pageSize=100&apiKey=${this.apiKey}`).then(e=>e.json()).then(e=>e.articles).catch(e=>s.errorCatch(e))}}(L,y,b,I),w=document.getElementById("card-template"),C=document,T=document.querySelector(".popup__close"),k=new i(document.getElementById("popup__enter")),A=document.getElementById("open-popupEnter"),B=document.getElementById("open-popupRegistration"),x=new i(document.getElementById("popupRegistration")),N=new g("",w,""),q=document.getElementById("form-enter"),M=document.getElementById("form-search"),D=document.getElementById("form-registration"),O=new _(q,v,k,N),j=new _(D,v,x,N),F=new _(M,"",""),U=document.getElementById("search-button"),P=document.getElementById("header__menu-mobile-main-page"),V=document.querySelector(".header__menu-mobile_close"),$=document.querySelector(".header__menu"),z=document.querySelector(".header__menu-mobile_close"),K=document.querySelector(".header__buttons"),H=document.querySelector(".header__info"),J=document.querySelector(".search-result");console.log(localStorage.getItem("token")),P.addEventListener("click",()=>{K.classList.add("header__buttons_open"),$.classList.add("header_dark"),P.classList.add("header__menu-mobile_off"),z.classList.add("header__menu-mobile_on"),H.classList.add("header__info_filter"),J.classList.add("search-result_filter")}),V.addEventListener("click",()=>{K.classList.toggle("header__buttons_open"),$.classList.toggle("header_dark"),P.classList.toggle("header__menu-mobile_off"),V.classList.remove("header__menu-mobile_on"),H.classList.remove("header__info_filter"),J.classList.remove("search-result_filter")}),T.addEventListener("click",()=>{k.close(),O.reset(),P.classList.toggle("header__menu-mobile_off")}),A.addEventListener("click",()=>{k.open(k),O.setEventListeners(),K.classList.toggle("header__buttons_open"),$.classList.toggle("header_dark"),V.classList.remove("header__menu-mobile_on")}),B.addEventListener("click",()=>{k.close(k),x.open(x),j.setEventListeners()}),F.setEventListeners(),U.addEventListener("click",()=>{new E(w,R,F,(e,t)=>new g(e,t,C),C).searchingNews()})}]);